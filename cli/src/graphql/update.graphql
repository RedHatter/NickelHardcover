query GetUserId {
	me {
		id
	}
}

query GetEdition($isbn: [String!]!, $book_id: Int!, $user_id: Int!) {
	editions(
		where: {
			_or: [
				{ asin: { _in: $isbn } }
				{ isbn_10: { _in: $isbn } }
				{ isbn_13: { _in: $isbn } }
				{ book_id: { _eq: $book_id } }
			]
		}
		limit: 1
	) {
		book {
			id
			pages
			default_ebook_edition {
				id
				pages
			}
			default_cover_edition {
				id
				pages
			}
			editions(
				where: {
					_or: [
						{ asin: { _in: $isbn } }
						{ isbn_10: { _in: $isbn } }
						{ isbn_13: { _in: $isbn } }
					]
				}
				limit: 1
			) {
				id
				pages
			}
			user_books(where: { user_id: { _eq: $user_id } }) {
				id
				status_id
				edition {
					pages
					id
				}
				user_book_reads(
					where: { finished_at: { _is_null: true } }
					order_by: { started_at: desc }
					limit: 1
				) {
					id
					started_at
					edition {
						id
						pages
					}
				}
			}
		}
	}
}

mutation InsertUserBook($book_id: Int!, $edition_id: Int!, $status_id: Int!) {
	insert_user_book(
		object: {
			edition_id: $edition_id
			book_id: $book_id
			status_id: $status_id
		}
	) {
		error
		user_book {
			id
			user_book_reads(
				where: { finished_at: { _is_null: true } }
				order_by: { started_at: desc }
				limit: 1
			) {
				id
				paused_at
				started_at
				edition {
					id
					pages
					book {
						pages
					}
				}
			}
		}
	}
}

mutation UpdateUserBookStatus($id: Int!) {
	update_user_book(id: $id, object: { status_id: 2 }) {
		id
		error
		user_book {
			user_book_reads(
				where: { finished_at: { _is_null: true } }
				order_by: { started_at: desc }
				limit: 1
			) {
				id
				paused_at
				started_at
				edition {
					id
					pages
					book {
						pages
					}
				}
			}
		}
	}
}

mutation UpdateRead(
	$id: Int!
	$progress_pages: Int!
	$edition_id: Int!
	$started_at: date!
) {
	update_user_book_read(
		id: $id
		object: {
			edition_id: $edition_id
			started_at: $started_at
			progress_pages: $progress_pages
		}
	) {
		id
		error
	}
}
